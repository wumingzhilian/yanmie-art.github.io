---
 layout:  post    # 使用的布局（不需要改）
 title:  网络编程  # 标题 
 subtitle:     #副标题
 date:  2020-12-20  # 时间
 author:  yanmie    # 作者
 header-img: img/.jpg ##标签这篇文章标题背景图片
 catalog: true      # 是否归档
 tags:        
   - 工具使用

---


## 一、协议的概念

通信双方指定的规则。

## 二、网络架构模式

#### 2.1 C/S

* 优点：  协议选用灵活(可以自定义)      缓存数据
* 缺点：  对用户的安全构成威胁(可能会对用户数据窃取等)           开发工作量比较大，调试困难

#### 2.2 B/S

* 优点： 对用户比较安全    跨平台       
* 缺点： 得用限定协议        设计比较困难那

## 三、网络分层模型

[![rUb7KH.md.png](https://s3.ax1x.com/2020/12/20/rUb7KH.md.png)](https://imgchr.com/i/rUb7KH)

1. 物理层： 主要定义物理设备标准，如网线接口类型、光纤接口类型、各种传输介质的传输速率。他的主要作用是传输比特流（就是由1、0转化为电流强弱来进行传输，到达目的地后再转化为1、0，也就是我们说的数模是、转换与模数转换）。这一层数据叫比特。
2. 数据链路层： 定义了如何让格式化数据以帧为单位进行传输，以及如何让控制对物理介质的访问。这一层通常还提供错误检测和纠正，以确保数据的可靠传输。
3. 网络层：在位于不同地理位置的网络中的两个主机系统之间提供连接和路劲选择，Internet的发展使得从世界各站点访问信息的用户数大大增加，而网络层正是管理这种连接的层。
4. 传输层：定义了一些传输数据的协议和端口号（www端口  80）,如 TCP（传输控制协议，传输效率低，可靠性强，用于传输可靠性要求高、数据量大的数据）， UDP（用户数据协议，与 TCP 特性恰恰相反，用于传输可靠性要求不高、数据量小的数据，QQ聊天等），主要是将从下层接收的数据进行分段和传输，到达目的地址后再进行重组，常常把这一层数据叫做段。
5. 会话层：通过传输层（端口号：传输端口与接收端口）建立数据传输的通路，主要在你的系统之间发起会话或者接受会话请求（设备之间需要互相认识可以是IP 也可以是 MAC或者主机名）。
6. 表示层：可确保一个系统的应用层所发送的信息可以被另一个系统的应用层读取。例如：PC程序与另一台计算机进行通信，其中一台计算机使用扩展二一十进制交换码，而另一台则用没过信息交换标准码（ASCII）来表示相同的字符，如有必要，表示层会通过使用一种通格式来实现多种数据格式之间的转换。
7. 应用层：是靠近用户的OSI层，这一层为用户的应用程序（例如电子邮件、文件传输和终端仿真）提供网络服务。

#### 3.1 通信过程

[![rUXyJx.md.png](https://s3.ax1x.com/2020/12/20/rUXyJx.md.png)](https://imgchr.com/i/rUXyJx)

是操作系统去封装解封数据的。

[![rUjUht.md.png](https://s3.ax1x.com/2020/12/20/rUjUht.md.png)](https://imgchr.com/i/rUjUht)



#### 3.2 以太网帧格式

[![raUdjs.md.png](https://s3.ax1x.com/2020/12/20/raUdjs.md.png)](https://imgchr.com/i/raUdjs)

[![raUTUK.md.png](https://s3.ax1x.com/2020/12/20/raUTUK.md.png)](https://imgchr.com/i/raUTUK)

[![raU64U.md.png](https://s3.ax1x.com/2020/12/20/raU64U.md.png)](https://imgchr.com/i/raU64U)

#### 3.3 ARP数据包格式

[![raUDH0.md.png](https://s3.ax1x.com/2020/12/20/raUDH0.md.png)](https://imgchr.com/i/raUDH0)

#### 3.4 IP段格式

[![raUq8e.md.png](https://s3.ax1x.com/2020/12/20/raUq8e.md.png)](https://imgchr.com/i/raUq8e)

[![raaF2Q.md.png](https://s3.ax1x.com/2020/12/20/raaF2Q.md.png)](https://imgchr.com/i/raaF2Q)

#### 3.5 TCP数据包格式

[![raassA.png](https://s3.ax1x.com/2020/12/20/raassA.png)](https://imgchr.com/i/raassA)

#### 3.6 UDP数据包格式

[![raaXJU.png](https://s3.ax1x.com/2020/12/20/raaXJU.png)](https://imgchr.com/i/raaXJU)

#### 3.6 寻路

https://blog.csdn.net/it_is_me_a/article/details/100435822

## 四、NAT映射

Network  Address  Translations

网络地址转换

路由器有 NAT映射表。

解决IPV4不够用。

NAT主要实现公私有IP地址的转换，一般是路由器或者防火墙上来完成，不建议在三层交换机上配置！

NAT有3大类：
1）静态NAT：1对1映射，（静态PAT，端口映射技术）
2）动态NAT
3）PAT（端口地址转换，Port Address Translations）
      PAT也称为端口复用技术

## 五、打洞机制

> 什么是打洞
>
> ###   什么是打洞，我们假设两个扣扣A,B，他们通信需要通过腾讯的服务器。也就是A发送消息给B的话，需要通过腾讯服务器进行一次转发，才到B那里。但像视频通话这要实时性要求比较高的通信，再用这种方式就不能保证他们通信的实时性，如果能想一个办法让他们直接通信，这样实时性就会高很多。但是我们所知的路由器是有一个保护机制的（对于陌生的IP第一次发送过来的数据包，会进行屏蔽或丢弃，主要是为了防止网络的恶意攻击），A跟B想进行通信的话所携带数据包的IP就必须是熟悉的，所以说这个时候就需要在两个路由器之间打一个洞，而这件事情上腾讯就参与进来了。    简单来说在我们登入扣扣的时候，就会访问腾讯服务器，而腾讯服务器也会回一个数据包，这个数据包会携带腾讯服务器公网的IP，相对于来说服务器的公网IP在A、B那里都是熟悉的IP（就是为了防止陌生IP屏蔽），而服务器借助公网IP帮助A、B完成打洞(打洞就是实现一种通路)，当它把这个洞打好以后A、B就可以实时通信。打洞是由服务器来完成的，最终的目的就是为了提高数据传输的效率。
>
> ### UDP打洞
>
>   **所谓udp打洞就是指客户端A通过udp协议向服务器发送数据包，服务器收到后，获取数据包，并且可获取客户端A地址和端口号。同样在客户端B发送给服务器udp数据包后，服务器同样在收到B发送过来的数据包后获取B的地址和端口号，将A和B的地址与端口号分别发送给对方，这样双方可以继续用UDP协议通信。这么做有什么用呢？因为对于一些应用或者需求，需要两个客户端临时做一些通信，而这种通信不需要建立tcp就可以完成，所以才去udp打洞。**

## 六、Socket 编程

socket  ---  套接字    一个发  一个收，成对出现，绑定ip地址和端口。

IP地址： 在网络环境中标识一台主机

端口号：在主机中唯一标识一个进程

IP + port : 在网络环境中唯一标识一个进程。