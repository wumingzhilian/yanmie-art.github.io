---
 layout:   post        # 使用的布局（不需要改）
 title:   探索php://filter以及死亡绕过   # 标题 
 subtitle:   #副标题
 date:    2020-09-05    # 时间
 author:   yanmie       # 作者
 header-img: img/.jpg  ##标签这篇文章标题背景图片
 catalog: true            # 是否归档
 tags:                
    - CTF

--- 

## php://filter

PHP 提供了一些杂项输入/输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符， 内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。 


* php:// — 访问各个输入/输出流（I/O streams）
* php://filter 是一种元封装器， 设计用于数据流打开时的筛选过滤应用。 这对于一体式（all-in-one）的文件函数非常有用，类似 readfile()、 file() 和 file_get_contents()， 在数据流内容读取之前没有机会应用其他过滤器。 

#### 参数

**php://filter可以作为一个中间流来处理其他流。**

![wVjSmQ.png](https://s1.ax1x.com/2020/09/05/wVjSmQ.png)


#### 使用

测试：

```
<?php
    $file1 = $_GET['file1'];
    $file2 = $_GET['file2'];
    $txt = $_GET['txt'];
    echo file_get_contents($file1);
    file_put_contents($file2,$txt);
?>
```

* file_get_contents — 将整个文件读入一个字符串
* file_put_contents — 将一个字符串写入文件

```]
 file_put_contents ( string $filename , mixed $data [, int $flags = 0 [, resource $context ]] ) : int


filename

    要被写入数据的文件名。
data

    要写入的数据。类型可以是 string，array 或者是 stream 资源（如上面所说的那样）。

    如果 data 指定为 stream 资源，这里 stream 中所保存的缓存数据将被写入到指定文件中，这种用法就相似于使用 stream_copy_to_stream() 函数。

    参数 data 可以是数组（但不能为多维数组），这就相当于 file_put_contents($filename, join('', $array))。


https://www.php.net/file_put_contents
```

那么这里可以读取文件也可以写入文件。

* **读取文件**


```
# 明文读取
index.php?file1=php://filter/resource=file.txt

# 编码读取
index.php?file1=php://filter/read=convert.base64-encode/resource=file.txt
```

* **写入文件**

```
# 明文写入
index.php
```





参考： https://www.anquanke.com/post/id/202510

https://xz.aliyun.com/t/8163

https://mp.weixin.qq.com/s?__biz=MjM5MTYxNjQxOA==&mid=2652861276&idx=1&sn=5948761b784b924ad8ee5a3abcbcc643&chksm=bd590f918a2e8687ceae5f6cf3924212c048bb6b4b2b079e7f3731d3ce892114503d58d8fff1&mpshare=1&scene=23&srcid=09029TH1s39lisKzMFVUHip2&sharer_sharetime=1598979305485&sharer_shareid=edfac7bd677646ff691b8c20fd81f149#rd