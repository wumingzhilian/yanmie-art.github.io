---
layout:     post               # 使用的布局（不需要改）
title:      sql注入总结   # 标题 
subtitle:       #副标题
date:       2020-07-17         # 时间
author:     yanmie             # 作者
header-img: img/.jpg    ##标签这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               
    - sqli-labs
  
---

## 一、什么是sql注入？

SQL注入是一种将SQL代码插入或添加到应用（用户）的输入参数中的攻击，之后再将这些参数传递给后台的sql服务器加以解析和执行。由于sql语句本身的多样性，以及可用于构造sql语句的编程方法很多，因此凡是构造sql语句的步骤均存在被攻击的潜在风险。Sql注入的方式主要是直接将代码插入参数中，这些参数会被置入sql命令中加以执行。间接的攻击方式是将恶意代码插入字符串中，之后将这些字符串保存到数据库的数据表中或将其当成元数据。当将存储的字符串置入动态sql命令中时，恶意代码就将被执行。

## 二、为什么会有SQL注入


 - 不当的字符处理
 - 不安全的数据库配置
 - 不合理的查询处理
 - 不当的错误处理
<hr/>

**1.不当的字符处理**
SQL数据库将单引号解析成了代码与数据的分割线，单引号外面的内容均是需要执行的的代码·。将用户输入直接传递给动态创建的SQL语句，单引号字符会被解析成字符分隔符，并作为代码与字符的分界。
注意：处理数字型数据是不需要使用单引号将数字数据引起来。

**2.不安全的数据库配置**
SQLSserver经常用“sa”作为数据库管理账户，MySQL使用“root”作为数据库管理账户，Oracle在创建数据库会创建SYS,SYSTEM和OUTLN账户。而一些默认账户会有默认密码。

**3.不合理的查询处理**
在进行数据库操作时，用户输入的数据没有严格的过滤，用户可以自己构造SQL语句，采用拼接、注释等方式构造SQL语句来执行自己的语句。（万能密码）

**4.不当的错误处理**
将详细的内部错误信息展示给用户或攻击者，一些错误信息会为攻击者提供网站缺陷或者有关的线索。开发和服务器配置时导致将错误直接回显。

## 三、SQL注入分类

1. 以字符类型分类

 		数字型：不需要单引号和双引号闭合
 		字符型：在注入中考虑引号的闭合和注释
2. 以注入方式分类

		回显：将构造的SQL语句执行后的结果回显或者报错的形式显示出来。
   	 
		盲注：开发时关闭错误显示，输入内容不在页面中展示出来

#### 回显注入


- 回显正常：通过执行构造的SQL语句注入后，页面与原有页面存在差异但没有报错信息。
- 回显报错：通过执行构造的SQL语句之后，页面报错，且将报错信息显示在页面上。


```
联合查询： union
报错注入： floor()   extractvalue()  updatexml()
宽字节注入
堆叠查询
```

#### 盲注

```
布尔盲注
时间盲注

```

具体测试方法可以看其他文章。

## 四、防止SQL注入

1、过滤掉一些常见的数据库操作关键字：select,insert,update,delete,and,*等

或者通过系统函数：addslashes(需要被过滤的内容)来进行过滤

2、在PHP配置文件中Register_globals=off;设置为关闭状态 //作用将注册全局变量关闭。

比如：接收POST表单的值使用$_POST['user'],如果将register_globals=on;直接使用$user可以接收表单的值。

3、SQL语句书写的时候尽量不要省略小引号(tab键上面那个)和单引号

4、提高数据库命名技巧，对于一些重要的字段根据程序的特点命名，取不易被猜到的

5、对于常用的方法加以封装，避免直接暴漏SQL语句

6、开启PHP安全模式Safe_mode=on;

7、打开magic_quotes_gpc来防止SQL注入Magic_quotes_gpc=off;默认是关闭的，它打开后将自动把用户提交的sql语句的查询进行转换，把'转为\'，这对防止sql注入有重大作用。

因此开启：magic_quotes_gpc=on;

8、控制错误信息

关闭错误提示信息，将错误信息写到系统日志。

9、使用mysqli或pdo预处理。



