---
layout:     post               # 使用的布局（不需要改）
title:      虚拟机之网络地址转换NAT与PAT  # 标题 
subtitle:      #副标题
date:       2020-06-27         # 时间
author:     yanmie             # 作者
header-img: img/.jpg    ##标签这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               
    - sqli-labs
  
---

## ***一、静态NAT***

将内部本地地址与内部全局地址进行一对一的明确转换。这种方法主要用在内部网络中有对外提供服务的服务器，如WEB、MAIL服务器时。该方法的缺点是需要独占宝贵的合法IP地址。即，如果某个合法IP地址已经被NAT静态地址转换定义，即使该地址当前没有被使用，也不能被用作其它的地址转换。(一对一固定转换)

## ***二、动态NAT***


动态地址转换也是将内部本地地址与内部全局地址进行一对一的转换。但是，是从内部全局地址池中动态地选择一个未使用的地址对内部本地地址进行转换。该地址是由未被使用的地址组成的地址池中在定义时排在最前面的一个。当数据传输完毕后，路由器将把使用完的内部全局地址放回到地址池中，以供其它内部本地地址进行转换。但是在该地址被使用时，不能用该地址再进行一次转换。（一对一随意转换）

## ***三、端口复用-PAT***

复用地址转换也称为端口地址转换（Port Address Translation，PAT）

PAT普遍应用于接入设备中，它可以将中小型的网络隐藏在一个合法的IP地址后面。PATT与动态地址NAT不同，它将内部连接映射到外部网络中的一个单独的IP地址上，同时在该地址上加上一个由NAT设备选定的TCP端口号。也就是采用port multiplexing 技术，或改变外出数据的源port的技术将多个内部ip地址映射到同一个外部地址。

理想状况下，一个单一的IP地址可以使用的端口数为4000个。

**举例：**

本地一win2k3 服务器接在vmnet8上，其ip为192.168.80.128。另一台winXP桥接到真实网络，winXP和真实物理机在同一网段，可以通信，但winXP想要3389远程链接win2k3是不能直接连接成功的。

那么此时我们可以利用PAT技术进行端口转发，
![pat端口转发](https://s1.ax1x.com/2020/06/26/NrIYu9.png)

将win2k3的3389端口映射到物理机的4000端口，那么winXP就可以通过访问物理机的4000端口连接就可以连接到win2k3了。

![连接到win2k3](https://s1.ax1x.com/2020/06/26/NroSv4.png)

win2k3在cmd窗口输入`netstat -n` 查看连接状态，发现winXP（192.168.0.108）已成功连接。

![win2k3cmd查看连接状态](https://s1.ax1x.com/2020/06/26/Nroe2D.png)
